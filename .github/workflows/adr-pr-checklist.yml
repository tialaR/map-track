name: ADR Checklist Validation

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

jobs:
  adr-pr-checklist:
    runs-on: ubuntu-latest

    steps:
      - name: Validate ADR checklist in PR description
        env:
          PR_BODY: ${{ github.event.pull_request.body }}
        run: |
          echo "ðŸ” Validating ADR checklist..."

          REQUIRED_CHECKS=(
            "ADR-001 â€” Code Readability & Explicit Logic"
            "ADR-002 â€” Hooks & Side Effects"
          )

          FAILED=0

          for CHECK in "${REQUIRED_CHECKS[@]}"; do
            if ! echo "$PR_BODY" | grep -q "\- \[x\] $CHECK"; then
              echo "âŒ Missing or unchecked: $CHECK"
              FAILED=1
            else
              echo "âœ… Checked: $CHECK"
            fi
          done

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## ðŸ“‹ ADR Checklist Summary" >> $GITHUB_STEP_SUMMARY

          if [ $FAILED -eq 1 ]; then
            echo "- âŒ ADR checklist is incomplete" >> $GITHUB_STEP_SUMMARY
            exit 1
          fi

          echo "- âœ… ADR-001 checked" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… ADR-002 checked" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸš€ PR checklist is complete." >> $GITHUB_STEP_SUMMARY
